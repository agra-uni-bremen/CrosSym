# This file is intended to be "included", not "include_directories()".
# This is to enable the language switch from a different file than the root file.

list(APPEND CMAKE_MODULE_PATH "${CMAKE_CURRENT_LIST_DIR}/CMake")

find_package( SystemC REQUIRED)
#set(UCLIBC_TARGET_TRIPLET x86_64-pc-linux-gnu)	#uclibc is built in this target triple

message("Build is set to: ${BUILD}")
if(BUILD STREQUAL "wllvm")
    MESSAGE("Building LLVM BYTECODE for Klee with wllvm")
    set(ENV{LLVM_COMPILER} [clang])		#dunno if this works, just call `export LLVM_COMPILER=clang`
    set(CMAKE_CXX_COMPILER "wllvm++")
    set(CMAKE_C_COMPILER "wllvm")
    set(CMAKE_C_COMPILER_TARGET ${UCLIBC_TARGET_TRIPLET})
    set(CMAKE_CXX_COMPILER_TARGET ${UCLIBC_TARGET_TRIPLET})
    set(SystemC_LIBRARIES ${SystemC_CXX_LIBRARIES})		# as long as it has been built with wllvm...
    SET(CMAKE_EXE_LINKER_FLAGS  "${CMAKE_EXE_LINKER_FLAGS} -Wl,--unresolved-symbols=ignore-in-object-files")	# for klee_int() and konsorten
    enable_language(CXX)
elseif(BUILD STREQUAL "bytecode")
    MESSAGE("Building LLVM BYTECODE for Klee")
    set(CMAKE_BYTECODE_COMPILER_TARGET ${UCLIBC_TARGET_TRIPLET})
    set(SystemC_LIBRARIES "${CMAKE_CURRENT_LIST_DIR}/systemc-dist/lib_llvm/libsystemc.so.2.3.3.bc")
    enable_language(BYTECODE)
else() #native
    enable_language(CXX)
    MESSAGE("Building native C/C++")
    set(CMAKE_CXX_COMPILER "clang++")
    set(CMAKE_C_COMPILER "clang")
    set(SystemC_LIBRARIES ${SystemC_CXX_LIBRARIES})
    SET(CMAKE_EXE_LINKER_FLAGS  "${CMAKE_EXE_LINKER_FLAGS} -Wl,--unresolved-symbols=ignore-in-object-files")	# for klee_int() and konsorten
endif()

message("Using SystemC from ${SystemC_LIBRARIES}")

find_package( SystemC REQUIRED)